"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[9031],{4060(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"api/FemapConverter","title":"FemapConverter","description":"FemapConverter converts EMSolution\'s FEMAP Neutral files to VTK MultiBlock UnstructuredGrid format for visualization in ParaView or with PyVista.","source":"@site/docs/api/FemapConverter.md","sourceDirName":"api","slug":"/api/FemapConverter","permalink":"/pyemsi/docs/api/FemapConverter","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/api/FemapConverter.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"FemapConverter"},"sidebar":"apiSidebar","previous":{"title":"Installation","permalink":"/pyemsi/docs/api/installation"},"next":{"title":"Plotter","permalink":"/pyemsi/docs/api/Plotter/"}}');var t=i(4848),s=i(8453);const l={sidebar_position:2,title:"FemapConverter"},o=void 0,c={},d=[{value:"Conversion Pipeline",id:"conversion-pipeline",level:3},{value:"Initialization",id:"initialization",level:3},{value:"Running the Conversion",id:"running-the-conversion",level:3},{value:"Output Structure",id:"output-structure",level:3},{value:"PVD Collection File",id:"pvd-collection-file",level:4},{value:"VTM Multiblock Files",id:"vtm-multiblock-files",level:4},{value:"PVD \u2192 VTM \u2192 VTU hierarchy (time series + data tree)",id:"pvd--vtm--vtu-hierarchy-time-series--data-tree",level:4},{value:"ParaView + PyVista support",id:"paraview--pyvista-support",level:4},{value:"Field Data",id:"field-data",level:4},{value:"Usage Example",id:"usage-example",level:3}];function a(e){const n={admonition:"admonition",code:"code",em:"em",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"FemapConverter"})," converts EMSolution's FEMAP Neutral files to VTK MultiBlock UnstructuredGrid format for visualization in ParaView or with PyVista."]}),"\n",(0,t.jsx)(n.h3,{id:"conversion-pipeline",children:"Conversion Pipeline"}),"\n",(0,t.jsx)(n.p,{children:"The converter executes a four-stage pipeline:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Build Mesh"})," \u2014 Parses the FEMAP neutral mesh file and creates a VTK unstructured grid"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Parse Data Files"})," \u2014 Reads all configured physics data files (magnetic, current, force, etc.) in parallel"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Initialize PVD"})," \u2014 Creates a PVD collection file that references all time steps"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Time Stepping"})," \u2014 Generates individual VTM files for each time step with all field data"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"initialization",children:"Initialization"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from pyemsi import FemapConverter\r\n\r\nconverter = FemapConverter(\r\n    input_dir,\r\n    output_dir="./.pyemsi",\r\n    output_name="output",\r\n    force_2d=False,\r\n    ascii_mode=False,\r\n    mesh="post_geom",\r\n    magnetic="magnetic",\r\n    current="current",\r\n    force="force",\r\n    force_J_B="force_J_B",\r\n    heat="heat",\r\n    displacement="disp"\r\n)\n'})}),"\n",(0,t.jsx)(n.admonition,{title:"Parameters",type:"tip",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"input_dir"})})," (",(0,t.jsx)(n.code,{children:"str | Path"}),", required) \u2014 Directory containing FEMAP neutral files"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"output_dir"})})," (",(0,t.jsx)(n.code,{children:"str | Path"}),", default: ",(0,t.jsx)(n.code,{children:'"./.pyemsi"'}),") \u2014 Directory where VTK output files will be written"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"output_name"})})," (",(0,t.jsx)(n.code,{children:"str"}),", default: ",(0,t.jsx)(n.code,{children:'"output"'}),") \u2014 Base name for output files (PVD file and VTM folder)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"force_2d"})})," (",(0,t.jsx)(n.code,{children:"bool"}),", default: ",(0,t.jsx)(n.code,{children:"False"}),") \u2014 Convert 3D elements to 2D equivalents (Hex8\u2192Quad4, Hex20\u2192Quad8, Wedge6\u2192Tri3, Wedge15\u2192Tri6)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"ascii_mode"})})," (",(0,t.jsx)(n.code,{children:"bool"}),", default: ",(0,t.jsx)(n.code,{children:"False"}),") \u2014 Write VTK files in ASCII format instead of binary"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"mesh"})})," (",(0,t.jsx)(n.code,{children:"str | Path"}),", default: ",(0,t.jsx)(n.code,{children:'"post_geom"'}),") \u2014 Path to mesh file, relative to ",(0,t.jsx)(n.code,{children:"input_dir"})," or absolute"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"magnetic"})})," (",(0,t.jsx)(n.code,{children:"str | Path | None"}),", default: ",(0,t.jsx)(n.code,{children:'"magnetic"'}),") \u2014 Path to magnetic field data file, or ",(0,t.jsx)(n.code,{children:"None"})," to skip"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"current"})})," (",(0,t.jsx)(n.code,{children:"str | Path | None"}),", default: ",(0,t.jsx)(n.code,{children:'"current"'}),") \u2014 Path to current density data file, or ",(0,t.jsx)(n.code,{children:"None"})," to skip"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"force"})})," (",(0,t.jsx)(n.code,{children:"str | Path | None"}),", default: ",(0,t.jsx)(n.code,{children:'"force"'}),") \u2014 Path to nodal force data file, or ",(0,t.jsx)(n.code,{children:"None"})," to skip"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"force_J_B"})})," (",(0,t.jsx)(n.code,{children:"str | Path | None"}),", default: ",(0,t.jsx)(n.code,{children:'"force_J_B"'}),") \u2014 Path to Lorentz force data file, or ",(0,t.jsx)(n.code,{children:"None"})," to skip"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"heat"})})," (",(0,t.jsx)(n.code,{children:"str | Path | None"}),", default: ",(0,t.jsx)(n.code,{children:'"heat"'}),") \u2014 Path to heat/thermal data file, or ",(0,t.jsx)(n.code,{children:"None"})," to skip"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"displacement"})})," (",(0,t.jsx)(n.code,{children:"str | Path"}),", default: ",(0,t.jsx)(n.code,{children:'"disp"'}),") \u2014 Path to displacement data file, or ",(0,t.jsx)(n.code,{children:"None"})," to skip"]}),"\n"]})}),"\n",(0,t.jsx)(n.h3,{id:"running-the-conversion",children:"Running the Conversion"}),"\n",(0,t.jsxs)(n.p,{children:["Call the ",(0,t.jsx)(n.code,{children:"run()"})," method to execute the complete conversion pipeline:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"converter.run()\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"run()"})," method:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Returns ",(0,t.jsx)(n.code,{children:"None"})]}),"\n",(0,t.jsxs)(n.li,{children:["Writes all output files to disk at the specified ",(0,t.jsx)(n.code,{children:"output_dir"})]}),"\n",(0,t.jsx)(n.li,{children:"Executes all four pipeline stages automatically"}),"\n",(0,t.jsx)(n.li,{children:"Uses parallel processing for data file parsing and time step generation"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"output-structure",children:"Output Structure"}),"\n",(0,t.jsx)(n.p,{children:"The converter generates the following files:"}),"\n",(0,t.jsx)(n.h4,{id:"pvd-collection-file",children:"PVD Collection File"}),"\n",(0,t.jsxs)(n.p,{children:["Location: ",(0,t.jsx)(n.code,{children:"{output_dir}/{output_name}.pvd"})]}),"\n",(0,t.jsx)(n.p,{children:"An XML collection file that references all time steps. Open this file in ParaView to view animations and time-series data."}),"\n",(0,t.jsx)(n.h4,{id:"vtm-multiblock-files",children:"VTM Multiblock Files"}),"\n",(0,t.jsxs)(n.p,{children:["Location: ",(0,t.jsx)(n.code,{children:"{output_dir}/{output_name}/"})]}),"\n",(0,t.jsx)(n.p,{children:"Individual VTM (VTK MultiBlock) files for each time step, containing:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Mesh geometry organized by PropertyID (material/component)"}),"\n",(0,t.jsx)(n.li,{children:"All physics field data for that time step"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"pvd--vtm--vtu-hierarchy-time-series--data-tree",children:"PVD \u2192 VTM \u2192 VTU hierarchy (time series + data tree)"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"*.pvd"})," is a lightweight ",(0,t.jsx)(n.strong,{children:"time-series index"})," (a VTK \u201cCollection\u201d XML file). It does not contain mesh geometry; instead it lists time steps and the file to load for each time."]}),"\n",(0,t.jsxs)(n.p,{children:["In ",(0,t.jsx)(n.code,{children:"pyemsi"}),", each time step points to a ",(0,t.jsx)(n.code,{children:"*.vtm"})," file, and each ",(0,t.jsx)(n.code,{children:"*.vtm"})," file (VTK MultiBlock dataset) references multiple ",(0,t.jsx)(n.code,{children:"*.vtu"})," files (VTK UnstructuredGrid) that contain the actual geometry and field arrays."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"On-disk tree"})," (what the converter writes):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"{output_dir}/\r\n    {output_name}.pvd\r\n    {output_name}/\r\n        STEP1 Time ... .vtm\r\n        STEP1 Time ... /\r\n            STEP1 Time ..._0.vtu\r\n            STEP1 Time ..._1.vtu\r\n            ...\r\n        STEP2 Time ... .vtm\r\n        STEP2 Time ... /\r\n            ...\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"PVD structure"})," (index of time steps):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<VTKFile type="Collection" ...>\r\n    <Collection>\r\n        <DataSet timestep="0.01" part="0" file="{output_name}/STEP1 Time 1.00000e-02.vtm"/>\r\n        <DataSet timestep="0.02" part="0" file="{output_name}/STEP2 Time 2.00000e-02.vtm"/>\r\n        ...\r\n    </Collection>\r\n</VTKFile>\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"VTM structure"})," (a multiblock \u201ctree\u201d whose leaves are VTU files):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<VTKFile type="vtkMultiBlockDataSet" ...>\r\n    <vtkMultiBlockDataSet>\r\n        <DataSet index="0" name="10" file="STEP1 Time .../STEP1 Time ..._0.vtu"/>\r\n        <DataSet index="1" name="20" file="STEP1 Time .../STEP1 Time ..._1.vtu"/>\r\n        ...\r\n    </vtkMultiBlockDataSet>\r\n</VTKFile>\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In this project, the multiblock ",(0,t.jsx)(n.code,{children:"name"})," corresponds to the ",(0,t.jsx)(n.strong,{children:"PropertyID"})," used to split the mesh into blocks. In ParaView, those names show up in the ",(0,t.jsx)(n.em,{children:"MultiBlock Inspector"}),", and in PyVista they show up as multiblock keys."]}),"\n",(0,t.jsx)(n.h4,{id:"paraview--pyvista-support",children:"ParaView + PyVista support"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ParaView"}),": open ",(0,t.jsx)(n.code,{children:"{output_name}.pvd"})," to get the full time series (animation timeline driven by the ",(0,t.jsx)(n.code,{children:"timestep="})," values). Each time step loads the corresponding ",(0,t.jsx)(n.code,{children:"*.vtm"}),", and the multiblock tree exposes each PropertyID block (each backed by a ",(0,t.jsx)(n.code,{children:"*.vtu"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"PyVista"}),": read the time series with ",(0,t.jsx)(n.code,{children:"pyvista.get_reader()"})," (returns a ",(0,t.jsx)(n.code,{children:"PVDReader"})," for ",(0,t.jsx)(n.code,{children:".pvd"}),"). Example:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import pyvista as pv\r\n\r\nreader = pv.get_reader(".pyemsi/output.pvd")\r\nprint(reader.time_values)          # available time values\r\nreader.set_active_time_value(0.02) # or set_active_time_point(i)\r\nmultiblock = reader.read()[0]      # a MultiBlock for that time step\r\n\r\n# Access blocks by index/name and plot\r\nprint(multiblock.keys())\r\nmultiblock.plot()\n'})}),"\n",(0,t.jsx)(n.h4,{id:"field-data",children:"Field Data"}),"\n",(0,t.jsx)(n.p,{children:"The converter adds the following field data to meshes based on configured data files:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Displacement"})," (modifies mesh geometry):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Applies displacement vectors to mesh points"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Magnetic"})," (from ",(0,t.jsx)(n.code,{children:"magnetic"})," file):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Point data: ",(0,t.jsx)(n.code,{children:"B-Vec (T)"}),", ",(0,t.jsx)(n.code,{children:"B-Mag (T)"}),", ",(0,t.jsx)(n.code,{children:"Flux (A/m)"})," (optional)"]}),"\n",(0,t.jsxs)(n.li,{children:["Cell data: ",(0,t.jsx)(n.code,{children:"B-Vec (T)"}),", ",(0,t.jsx)(n.code,{children:"B-Mag (T)"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Current"})," (from ",(0,t.jsx)(n.code,{children:"current"})," file):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Point data: ",(0,t.jsx)(n.code,{children:"J-Vec (A/m^2)"}),", ",(0,t.jsx)(n.code,{children:"J-Mag (A/m^2)"}),", ",(0,t.jsx)(n.code,{children:"Loss (W/m^3)"})]}),"\n",(0,t.jsxs)(n.li,{children:["Cell data: ",(0,t.jsx)(n.code,{children:"J-Vec (A/m^2)"}),", ",(0,t.jsx)(n.code,{children:"J-Mag (A/m^2)"}),", ",(0,t.jsx)(n.code,{children:"Loss (W/m^3)"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Force"})," (from ",(0,t.jsx)(n.code,{children:"force"})," file):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Point data: ",(0,t.jsx)(n.code,{children:"F Nodal-Vec (N/m^3)"}),", ",(0,t.jsx)(n.code,{children:"F Nodal-Mag (N/m^3)"})]}),"\n",(0,t.jsxs)(n.li,{children:["Cell data: ",(0,t.jsx)(n.code,{children:"F Nodal-Vec (N/m^3)"}),", ",(0,t.jsx)(n.code,{children:"F Nodal-Mag (N/m^3)"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Lorentz Force"})," (from ",(0,t.jsx)(n.code,{children:"force_J_B"})," file):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Point data: ",(0,t.jsx)(n.code,{children:"F Lorents-Vec (N/m^3)"}),", ",(0,t.jsx)(n.code,{children:"F Lorents-Mag (N/m^3)"})]}),"\n",(0,t.jsxs)(n.li,{children:["Cell data: ",(0,t.jsx)(n.code,{children:"F Lorents-Vec (N/m^3)"}),", ",(0,t.jsx)(n.code,{children:"F Lorents-Mag (N/m^3)"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Heat"})," (from ",(0,t.jsx)(n.code,{children:"heat"})," file):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Point data: ",(0,t.jsx)(n.code,{children:"Heat Density (W/m^3)"}),", ",(0,t.jsx)(n.code,{children:"Heat (W)"})]}),"\n",(0,t.jsxs)(n.li,{children:["Cell data: ",(0,t.jsx)(n.code,{children:"Heat Density (W/m^3)"}),", ",(0,t.jsx)(n.code,{children:"Heat (W)"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"usage-example",children:"Usage Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from pyemsi import FemapConverter\r\n\r\n# Basic conversion with default settings\r\nconverter = FemapConverter(r"\\path\\to\\femap\\files")\r\nconverter.run()\r\n\r\n# Skip current density processing\r\nconverter = FemapConverter(\r\n    r"\\path\\to\\femap\\files",\r\n    output_name="my_simulation",\r\n    current=None\r\n)\r\nconverter.run()\r\n\r\n# Force 2D mode for planar meshes\r\nconverter = FemapConverter(\r\n    r"\\path\\to\\femap\\files",\r\n    force_2d=True\r\n)\r\nconverter.run()\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The output can be visualized with the ",(0,t.jsx)(n.code,{children:"Plotter"})," class or opened directly in ParaView:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from pyemsi import Plotter\r\n\r\n# Visualize the results\r\nplotter = Plotter(".pyemsi/output.pvd")\r\nplotter.set_scalar("B-Mag (T)", mode="element", cell2point=True)\r\nplotter.show()\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>o});var r=i(6540);const t={},s=r.createContext(t);function l(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);